<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3x3 Matrix Calculator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['monospace'],
                    },
                }
            }
        }
    </script>
    <style>
        /* Custom styles for matrix input cells */
        .matrix-cell {
            width: 100%;
            padding: 8px 4px;
            text-align: center;
            border: none;
            background-color: #f3f4f6;
            transition: background-color 0.15s;
        }
        .matrix-cell:focus {
            background-color: #e5e7eb;
            outline: 2px solid #3b82f6; /* Blue outline on focus */
        }
        /* Hide number input arrows (optional, for aesthetics) */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 sm:p-8 font-sans">

    <div class="max-w-4xl mx-auto bg-white shadow-2xl rounded-xl p-6 md:p-10">

        <!-- Title and Note -->
        <h1 class="text-3xl font-extrabold text-gray-900 mb-2 border-b-4 border-indigo-500 pb-2">
            3x3 Matrix Calculator
        </h1>
        <p class="text-sm font-medium text-red-600 bg-red-100 p-2 rounded-lg mb-6 shadow-inner">
            NOTE: This calculator works **ONLY** for 3x3 matrices.
        </p>

        <!-- Main Grid Layout for Matrices -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">

            <!-- Matrix A Input -->
            <div class="bg-indigo-50 p-6 rounded-xl shadow-lg border border-indigo-200">
                <h2 class="text-xl font-semibold text-indigo-800 mb-4">Matrix A</h2>
                <div class="grid grid-cols-3 gap-2" id="matrixA">
                    <!-- Inputs for A[0][0] to A[2][2] will be generated here by JavaScript -->
                </div>
            </div>

            <!-- Matrix B Input -->
            <div class="bg-purple-50 p-6 rounded-xl shadow-lg border border-purple-200">
                <h2 class="text-xl font-semibold text-purple-800 mb-4">Matrix B</h2>
                <div class="grid grid-cols-3 gap-2" id="matrixB">
                    <!-- Inputs for B[0][0] to B[2][2] will be generated here by JavaScript -->
                </div>
            </div>

        </div>

        <!-- Power Input and Operation Buttons -->
        <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 mb-8">
            
            <div class="flex flex-col sm:flex-row items-center justify-between gap-4 mb-6">
                <div class="flex items-center space-x-2">
                    <label for="powerN" class="text-lg font-medium text-gray-700">Power (n) for A^n:</label>
                    <input type="number" id="powerN" value="2" min="0" 
                           class="w-20 p-2 border border-gray-300 rounded-lg text-center focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-150">
                </div>
                <div id="error-message" class="text-red-500 font-semibold hidden"></div>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <button onclick="calculate('add')" class="op-button bg-green-500 hover:bg-green-600">
                    A + B (Add)
                </button>
                <button onclick="calculate('subtract')" class="op-button bg-yellow-500 hover:bg-yellow-600">
                    A - B (Subtract)
                </button>
                <button onclick="calculate('multiply')" class="op-button bg-blue-500 hover:bg-blue-600">
                    A × B (Multiply)
                </button>
                <button onclick="calculate('power')" class="op-button bg-red-500 hover:bg-red-600">
                    A^n (Power)
                </button>
            </div>
        </div>

        <!-- Result Display Area -->
        <div class="bg-gray-800 text-white p-6 rounded-xl shadow-2xl">
            <h2 class="text-2xl font-bold mb-4 text-center text-gray-100" id="resultTitle">Result (Matrix C)</h2>
            <div id="resultMatrix" class="grid grid-cols-3 gap-2 p-4 bg-gray-900 rounded-lg max-w-xs mx-auto text-xl font-mono shadow-inner">
                <!-- Result cells will be populated here -->
            </div>
            <p class="mt-4 text-sm text-center text-gray-400" id="resultOpDescription">
                Select an operation above to view the result.
            </p>
        </div>

    </div>

    <script>
        // --- JAVASCRIPT LOGIC ---

        const SIZE = 3;

        // --- DOM GENERATION AND INITIALIZATION ---

        function generateMatrixInputs(matrixId) {
            const container = document.getElementById(matrixId);
            container.innerHTML = '';
            for (let i = 0; i < SIZE; i++) {
                for (let j = 0; j < SIZE; j++) {
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.id = `${matrixId}-${i}-${j}`;
                    input.value = (i === j) ? 1 : 0; // Default to identity matrix for easy testing
                    // Added a class for easier selection
                    input.className = 'matrix-cell rounded-md focus:ring-blue-500 focus:border-blue-500 text-lg';
                    container.appendChild(input);
                }
            }
        }

        // Initialize inputs on load
        document.addEventListener('DOMContentLoaded', () => {
            generateMatrixInputs('matrixA');
            generateMatrixInputs('matrixB');
            // Initialize result matrix display
            const resultContainer = document.getElementById('resultMatrix');
            for (let i = 0; i < SIZE; i++) {
                for (let j = 0; j < SIZE; j++) {
                    const div = document.createElement('div');
                    div.id = `result-${i}-${j}`;
                    div.className = 'bg-gray-700 p-2 rounded-md text-center text-gray-50';
                    div.textContent = '0';
                    resultContainer.appendChild(div);
                }
            }

            // Apply Tailwind styles to buttons after generation
            document.querySelectorAll('.op-button').forEach(button => {
                button.className += ' text-white font-bold py-3 px-4 rounded-xl shadow-lg transform transition duration-150 hover:scale-[1.02] active:scale-[0.98]';
            });

            // --- NEW LOGIC FOR ENTER KEY NAVIGATION ---
            const orderedInputs = [];
            
            // 1. Order Matrix A (row by row: 0,0 -> 0,1 -> ... -> 2,2)
            for (let i = 0; i < SIZE; i++) {
                for (let j = 0; j < SIZE; j++) {
                    orderedInputs.push(document.getElementById(`matrixA-${i}-${j}`));
                }
            }
            
            // 2. Order Matrix B (row by row)
            for (let i = 0; i < SIZE; i++) {
                for (let j = 0; j < SIZE; j++) {
                    orderedInputs.push(document.getElementById(`matrixB-${i}-${j}`));
                }
            }

            // 3. Order Power N input
            orderedInputs.push(document.getElementById('powerN'));

            // Add keydown listener to the document
            document.addEventListener('keydown', (event) => {
                if (event.key === 'Enter') {
                    const activeElement = document.activeElement;
                    // Ensure the active element is a managed input (matrix cell or power input)
                    const currentIndex = orderedInputs.indexOf(activeElement);
                    
                    if (currentIndex !== -1) {
                        event.preventDefault(); // Prevent default browser behavior (e.g., button click)
                        
                        let nextIndex = currentIndex + 1;
                        
                        if (nextIndex < orderedInputs.length) {
                            // Move focus to the next input element
                            const nextInput = orderedInputs[nextIndex];
                            nextInput.focus();
                            nextInput.select(); // Highlight the text for easy overwriting
                        } else {
                            // If user presses Enter on the last input (#powerN), automatically trigger the Power calculation
                            calculate('power'); 
                            activeElement.blur();
                        }
                    }
                }
            });
            // --- END NEW LOGIC ---
        });

        // --- UTILITY FUNCTIONS ---

        /**
         * Reads the 3x3 matrix values from the HTML inputs.
         * @param {string} matrixId - 'matrixA' or 'matrixB'.
         * @returns {number[][]} The 3x3 matrix as a 2D array.
         */
        function getMatrix(matrixId) {
            const matrix = [];
            for (let i = 0; i < SIZE; i++) {
                matrix[i] = [];
                for (let j = 0; j < SIZE; j++) {
                    const inputElement = document.getElementById(`${matrixId}-${i}-${j}`);
                    // Use parseInt and handle potential empty/NaN input by defaulting to 0
                    matrix[i][j] = parseInt(inputElement.value || '0', 10);
                }
            }
            return matrix;
        }

        /**
         * Displays the resulting matrix in the output area.
         * @param {number[][]} matrix - The 3x3 result matrix.
         */
        function displayResult(matrix) {
            for (let i = 0; i < SIZE; i++) {
                for (let j = 0; j < SIZE; j++) {
                    const resultElement = document.getElementById(`result-${i}-${j}`);
                    resultElement.textContent = matrix[i][j];
                }
            }
        }

        /**
         * Shows a temporary error message.
         * @param {string} message - The error text.
         */
        function displayError(message) {
            const errorElement = document.getElementById('error-message');
            errorElement.textContent = `❌ ${message}`;
            errorElement.classList.remove('hidden');
            setTimeout(() => {
                errorElement.classList.add('hidden');
            }, 4000);
        }

        // --- CORE MATRIX OPERATIONS (Translated from Java) ---

        /**
         * Adds two 3x3 matrices. C = A + B
         */
        function addMatrices(a, b) {
            const c = [];
            for (let i = 0; i < SIZE; i++) {
                c[i] = [];
                for (let j = 0; j < SIZE; j++) {
                    c[i][j] = a[i][j] + b[i][j];
                }
            }
            return c;
        }

        /**
         * Subtracts two 3x3 matrices. C = A - B
         */
        function subtractMatrices(a, b) {
            const c = [];
            for (let i = 0; i < SIZE; i++) {
                c[i] = [];
                for (let j = 0; j < SIZE; j++) {
                    c[i][j] = a[i][j] - b[i][j];
                }
            }
            return c;
        }

        /**
         * Multiplies two 3x3 matrices. C = A x B
         */
        function multiplyMatrices(a, b) {
            const c = [];
            for (let i = 0; i < SIZE; i++) {
                c[i] = [];
                for (let j = 0; j < SIZE; j++) {
                    let sum = 0;
                    for (let k = 0; k < SIZE; k++) {
                        sum += a[i][k] * b[k][j];
                    }
                    c[i][j] = sum;
                }
            }
            return c;
        }

        /**
         * Calculates A^n using repeated multiplication.
         * @param {number[][]} a - The base matrix.
         * @param {number} n - The power.
         */
        function powerMatrix(a, n) {
            // Identity matrix
            const identity = Array(SIZE).fill(0).map((_, i) => 
                Array(SIZE).fill(0).map((_, j) => (i === j ? 1 : 0))
            );

            if (n === 0) {
                return identity;
            }
            if (n === 1) {
                // Return a copy of A
                return a.map(row => [...row]); 
            }

            let result = a.map(row => [...row]); // Start with A^1
            
            // Perform multiplication (n - 1) times
            for (let p = 1; p < n; p++) {
                result = multiplyMatrices(result, a);
            }
            return result;
        }

        // --- MAIN CALCULATE FUNCTION ---

        function calculate(operation) {
            try {
                const matrixA = getMatrix('matrixA');
                let matrixB = null;
                let result = null;
                let title = '';
                let description = '';

                switch (operation) {
                    case 'add':
                        matrixB = getMatrix('matrixB');
                        result = addMatrices(matrixA, matrixB);
                        title = 'Matrix A + B';
                        description = 'The sum of the two matrices.';
                        break;
                    case 'subtract':
                        matrixB = getMatrix('matrixB');
                        result = subtractMatrices(matrixA, matrixB);
                        title = 'Matrix A - B';
                        description = 'The difference between Matrix A and Matrix B.';
                        break;
                    case 'multiply':
                        matrixB = getMatrix('matrixB');
                        result = multiplyMatrices(matrixA, matrixB);
                        title = 'Matrix A × B';
                        description = 'The product of Matrix A and Matrix B.';
                        break;
                    case 'power':
                        const nInput = document.getElementById('powerN');
                        const n = parseInt(nInput.value || '0', 10);
                        
                        if (isNaN(n) || n < 0) {
                            throw new Error("Invalid power value. Please enter an integer $\\ge 0$.");
                        }
                        
                        result = powerMatrix(matrixA, n);
                        title = `Matrix A ^ ${n}`;
                        description = `Matrix A multiplied by itself ${n} times.`;
                        break;
                    default:
                        throw new Error("Invalid operation selected.");
                }

                // Display result and update titles
                displayResult(result);
                document.getElementById('resultTitle').textContent = `${title} Result`;
                document.getElementById('resultOpDescription').textContent = description;

            } catch (error) {
                console.error(error);
                displayError(error.message);
                // Clear the result area on error
                displayResult(Array(SIZE).fill(0).map(() => Array(SIZE).fill(0)));
                document.getElementById('resultTitle').textContent = 'Error!';
                document.getElementById('resultOpDescription').textContent = 'Please check your inputs and try again.';
            }
        }

    </script>
</body>
</html>
